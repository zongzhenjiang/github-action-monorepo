on: push

jobs:
    loop-through-projects:
        runs-on: ubuntu-latest
        steps:
        - name: Checkout Code
          uses: actions/checkout@v4
          with:
            fetch-depth: 0
        
        - name: Install dependencies
          run: |
            npm install -g pnpm@latest-10
            pnpm --version
        
        - name: Loop through files in a directory
          run: |
            files=()
            for dir in webs/*; do
              if [ -d "$dir" ]; then
                echo "Directory: $dir"
                if git diff --quiet HEAD^ HEAD -- "$dir"; then
                  echo "No changes."
                else
                  files+=("$dir")
                  echo "Changes detected."
                fi
              fi
            done
            echo "files=${files[@]}" >> $GITHUB_ENV
            
        - name: Print Result
          run: |
            # Retrieve the files from the environment variable
            echo "Files from previous step: $files"

            # Do something with the files, e.g., list them
            for file in $files; do
              echo "Processing file: $file"
            done